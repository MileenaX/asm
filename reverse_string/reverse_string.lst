     1                                  global _start
     2                                  
     3                                  section .data
     4 00000000 456E74657220796F75-         msg db "Enter your string: ", 0
     4 00000009 7220737472696E673A-
     4 00000012 2000               
     5                                      len_msg  equ $ - msg
     6 00000014 52657365727665643A-         rev_msg db "Reserved: ", 0
     6 0000001D 2000               
     7                                      len_rev_msg  equ $ - rev_msg
     8                                      len_buf equ 101
     9                                      
    10                                  section .bss
    11 00000000 <res 65h>                   buffer resb len_buf			;буффер для ввода строки
    12                                      
    13                                  section .text
    14                                  
    15                                  reverse_string:				;функция разворачивает строку с использованием стека, параметры rdi-указать на строку, rsi-длина строки
    16 00000000 55                          push rbp				;сохраняем базовый указатель стека
    17 00000001 4889E5                      mov rbp, rsp			;устанавливаем новый базовый указатель
    18                                  
    19 00000004 B900000000                  mov rcx, 0				;счетчик цикла
    20                                      
    21                                  ;цикл записи в стек
    22                                  push_loop:
    23 00000009 4839F1                      cmp rcx, rsi
    24 0000000C 7D09                        jge done_pushing
    25                                      
    26 0000000E 8A040F                      mov al, [rdi + rcx]
    27 00000011 50                          push rax
    28 00000012 48FFC1                      inc rcx
    29 00000015 EBF2                        jmp push_loop
    30                                      
    31                                  done_pushing:
    32 00000017 B900000000                  mov rcx, 0				;обнуление счетчика цикла
    33                                  
    34                                  ;цикл считывания из стека
    35                                  pop_loop:
    36 0000001C 4839F1                      cmp rcx, rsi
    37 0000001F 7D09                        jge done_reversing
    38                                      
    39 00000021 58                          pop rax
    40 00000022 88040F                      mov [rdi + rcx], al
    41 00000025 48FFC1                      inc rcx
    42 00000028 EBF2                        jmp pop_loop
    43                                      
    44                                  done_reversing:
    45 0000002A 4889EC                      mov rsp, rbp
    46 0000002D 5D                          pop rbp
    47 0000002E C3                          ret   
    48                                      
    49                                  
    50                                  _start:
    51                                      ;вывод приглашения
    52 0000002F B801000000                  mov rax, 1
    53 00000034 BF01000000                  mov rdi, 1
    54 00000039 48BE-                       mov rsi, msg
    54 0000003B [0000000000000000] 
    55 00000043 BA14000000                  mov rdx, len_msg
    56 00000048 0F05                        syscall
    57                                      
    58 0000004A 4883F800                    cmp rax, 0			   ; проверяем, что значение больше нуля
    59 0000004E 0F8C98000000                jl error_exit
    60                                      
    61 00000054 4839D0                      cmp rax, rdx		   ; проверяем, что значение равно длине строки
    62 00000057 0F858F000000                jne error_exit
    63                                      
    64                                      ;чтение строки с клавиатуры
    65 0000005D B800000000                  mov rax, 0
    66 00000062 BF00000000                  mov rdi, 0
    67 00000067 48BE-                       mov rsi, buffer
    67 00000069 [0000000000000000] 
    68 00000071 BA65000000                  mov rdx, len_buf
    69 00000076 0F05                        syscall
    70                                      
    71 00000078 4883F800                    cmp rax, 0			   ; проверяем, что значение больше нуля
    72 0000007C 7C6E                        jl error_exit
    73                                      
    74 0000007E 4989C4                      mov r12, rax 		   ;сохраняем длину считанной строки
    75 00000081 49FFCC                      dec r12			   ;уменьшаем для исключения символа новой строки
    76                                      
    77                                      ;вызов функции reverse_string
    78 00000084 48BF-                       mov rdi, buffer
    78 00000086 [0000000000000000] 
    79 0000008E 4C89E6                      mov rsi, r12
    80 00000091 E86AFFFFFF                  call reverse_string
    81                                      
    82                                      ;вывод ответа
    83 00000096 B801000000                  mov rax, 1
    84 0000009B BF01000000                  mov rdi, 1
    85 000000A0 48BE-                       mov rsi, rev_msg
    85 000000A2 [1400000000000000] 
    86 000000AA BA0B000000                  mov rdx, len_rev_msg
    87 000000AF 0F05                        syscall
    88                                  
    89 000000B1 4883F800                    cmp rax, 0			   ; проверяем, что значение больше нуля
    90 000000B5 7C35                        jl error_exit
    91                                      
    92 000000B7 4839D0                      cmp rax, rdx		   ; проверяем, что значение равно длине строки
    93 000000BA 7530                        jne error_exit
    94                                  
    95 000000BC B801000000                  mov rax, 1
    96 000000C1 BF01000000                  mov rdi, 1
    97 000000C6 48BE-                       mov rsi, buffer
    97 000000C8 [0000000000000000] 
    98 000000D0 4C89E2                      mov rdx, r12
    99 000000D3 0F05                        syscall
   100                                    
   101 000000D5 4883F800                    cmp rax, 0			   ; проверяем, что значение больше нуля
   102 000000D9 7C11                        jl error_exit
   103                                      
   104 000000DB 4839D0                      cmp rax, rdx		   ; проверяем, что значение равно длине строки
   105 000000DE 750C                        jne error_exit    
   106                                      
   107                                      ;завершение программы
   108 000000E0 B800000000                  mov rax, 0
   109 000000E5 BF00000000                  mov rdi, 0
   110 000000EA 0F05                        syscall
   111                                      
   112                                  error_exit:			   ;обработка ошибки
   113 000000EC B83C000000                  mov rax, 60		           
   114 000000F1 BF01000000                  mov rdi, 1			   ;код возврата -1 (ошибка)
   115 000000F6 0F05                        syscall
   116                                      
   117                                  
   118                                      
   119                                      
